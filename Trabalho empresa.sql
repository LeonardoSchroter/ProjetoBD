create database exercicio_aula;

use exercicio_aula;

create table FUNCIONARIO(
	Pnome VARCHAR(15) NOT NULL,
    Minicial CHAR,
    Unome VARCHAR(15) NOT NULL,
    Cpf CHAR(11) PRIMARY KEY,
    datanasc DATE,
    Endereco VARCHAR(255),
    Sexo CHAR,
    Salario DECIMAL(10,2),
    Cpf_supervisor CHAR(11),
    Dnr INT,
    
    FOREIGN KEY(Cpf_supervisor) REFERENCES FUNCIONARIO(cpf) 
);
drop table FUNCIONARIO;
DROP TABLE TRABALHA_EM;

INSERT INTO FUNCIONARIO VALUES('Jorge','E','BRITO','88866555576','1937-11-10','Rua do Horto,35,São Paulo,SP','M',55.00,NULL,1);
INSERT INTO FUNCIONARIO VALUES('Jennifer','S','Souza','98765432168','1941-06-20','AV.Arthur de Lima,54,Santo André,SP','F',43000,'88866555576',4);
INSERT INTO FUNCIONARIO VALUES('FERNANDO','T','Wong','33344555587','1955-12-08','Rua da Lapa,34,São Paulo,SP','M',40000,'88866555576',5);
INSERT INTO FUNCIONARIO VALUES('João','B','Silva','12345678966','1965-01-09','Rua das Flores,751,São Paulo,SP','M',30000,'33344555587',5);
INSERT INTO FUNCIONARIO VALUES('Alice','J','Zelaya','99988777767','1968-01-19','Rua Souza Lima,35,Curitiba,PR','F',25000,'98765432168',4);
INSERT INTO FUNCIONARIO VALUES('Ronaldo','K','Lima','66688444476','1962-09-15','Rua Rebouças,65,Piracicaba,SP','M',38000,'33344555587',5);
INSERT INTO FUNCIONARIO VALUES('Joice','A','Leite','45345345376','1972-07-31','AV.Lucas Obes,74,São Paulo,SP','F',25000,'33344555587',5);
INSERT INTO FUNCIONARIO VALUES ('André','E','Pereira','98798798733','1969-03-29','Rua Timbira,35,São Paulo,SP','M',55000,'98765432168',4);


UPDATE FUNCIONARIO
SET Salario = 55000, Unome = 'Brito'
WHERE   Cpf= '88866555576';
SELECT * FROM FUNCIONARIO;

create table DEPARTAMENTO(
	Dnome VARCHAR(15) NOT NULL,
    Dnumero INT PRIMARY KEY,
    Cpf_gerente CHAR(11),
    Data_inicio_gerente DATE,
    UNIQUE (Dnome),
    FOREIGN KEY (Cpf_gerente) REFERENCES FUNCIONARIO(Cpf)
);

INSERT INTO DEPARTAMENTO(Dnome,Dnumero) VALUES ('Matriz',1);
INSERT INTO DEPARTAMENTO(Dnome,Dnumero) VALUES ('Pesquisa',5);
INSERT INTO DEPARTAMENTO(Dnome,Dnumero) VALUES ('Administração',4);

UPDATE DEPARTAMENTO
SET Cpf_gerente = '88866555576', Data_Inicio_Gerente = '1981-06-19'
where Dnumero = 1;

UPDATE DEPARTAMENTO
SET Cpf_gerente = '98765432168', Data_Inicio_Gerente = '1995-01-01'
where Dnumero = 4;

UPDATE DEPARTAMENTO
SET Cpf_gerente = '33344555587', Data_Inicio_Gerente = '1988-05-22'
where Dnumero = 5;



#RESTRIÇÃO REFERENCIAL EM FUNCIONARIO DE DEPARTAMENTO
ALTER TABLE FUNCIONARIO
ADD CONSTRAINT Dnr
FOREIGN KEY (Dnr) REFERENCES DEPARTAMENTO (Dnumero);

CREATE TABLE LOCALIZACAO_DEP(
	Dnumero INT NOT NULL,
    Dlocal VARCHAR(15) NOT NULL,
    PRIMARY KEY (Dnumero, Dlocal),
    FOREIGN KEY (Dnumero) REFERENCES DEPARTAMENTO (Dnumero)
);

INSERT INTO LOCALIZACAO_DEP VALUES(1,'São Paulo');
INSERT INTO LOCALIZACAO_DEP VALUES(4,'Mauá');
INSERT INTO LOCALIZACAO_DEP VALUES(5,'Santo André');
INSERT INTO LOCALIZACAO_DEP VALUES(5,'Itu');
INSERT INTO LOCALIZACAO_DEP VALUES(5,'São Paulo');

create table PROJETO(
	Projnome VARCHAR(15) NOT NULL,
    Projnumero INT PRIMARY KEY,
    Projlocal VARCHAR(15),
    Dnum INT,
    UNIQUE (Projnome),
    FOREIGN KEY (Dnum) REFERENCES DEPARTAMENTO (Dnumero)
);
INSERT INTO PROJETO VALUES ('ProdutoX',1,'Santo André',5);
INSERT INTO PROJETO VALUES ('ProdutoY',2,'Itu',5);
INSERT INTO PROJETO VALUES ('ProdutoZ',3,'São Paulo',5);
INSERT INTO PROJETO VALUES ('Informatização',10,'Mauá',4);
INSERT INTO PROJETO VALUES ('Reorganização',20,'São Paulo',1);
INSERT INTO PROJETO VALUES ('NovosBenefícios',30,'Mauá',4);


create table TRABALHA_EM(
	Fcpf CHAR(11) NOT NULL,
    Pnr INT NOT NULL,
    Horas DECIMAL(3,1) ,
    PRIMARY KEY (Fcpf, Pnr),
    CONSTRAINT pk_funcionario FOREIGN KEY(Fcpf) references FUNCIONARIO(cpf) ,
    CONSTRAINT pk_projeto FOREIGN KEY(Pnr) references PROJETO(Projnumero) 
    
);

INSERT INTO TRABALHA_EM VALUES('12345678966',1,32.5);
INSERT INTO TRABALHA_EM VALUES('12345678966',2,7.5);
INSERT INTO TRABALHA_EM VALUES('66688444476',3,40);
INSERT INTO TRABALHA_EM VALUES('45345345376',1,20);
INSERT INTO TRABALHA_EM VALUES('45345345376',2,20);
INSERT INTO TRABALHA_EM VALUES('33344555587',2,10);
INSERT INTO TRABALHA_EM VALUES('33344555587',3,10);
INSERT INTO TRABALHA_EM VALUES('33344555587',10,10);
INSERT INTO TRABALHA_EM VALUES('33344555587',20,10);
INSERT INTO TRABALHA_EM VALUES('99988777767',30,30);
INSERT INTO TRABALHA_EM VALUES('99988777767',10,10);
INSERT INTO TRABALHA_EM VALUES('98798798733',10,35);
INSERT INTO TRABALHA_EM VALUES('98798798733',30,5);
INSERT INTO TRABALHA_EM VALUES('98765432168',30,20);
INSERT INTO TRABALHA_EM VALUES('98765432168',30,15);
INSERT INTO TRABALHA_EM VALUES('88866555576',20,null);

DELETE FROM TRABALHA_EM
WHERE FCPF = '98798798733';


CREATE TABLE DEPENDENTE(
	Fcpf CHAR(11) NOT NULL ,
    Nome_dependente VARCHAR(15) NOT NULL,
    Sexo CHAR,
    Datanasc DATE,
    Parentesco VARCHAR(8),
    PRIMARY KEY (Fcpf,Nome_dependente),
    FOREIGN KEY(Fcpf) REFERENCES FUNCIONARIO(Cpf)
);

INSERT INTO DEPENDENTE VALUES ('33344555587','Alicia','F','1986-04-05','Filha');
INSERT INTO DEPENDENTE VALUES ('33344555587','Tiago','M','1983-10-25','Filho');
INSERT INTO DEPENDENTE VALUES ('33344555587','Janaína','F','1986-04-05','Esposa');
INSERT INTO DEPENDENTE VALUES ('98765432168','Antonio','M','1942-02-28','Marido');
INSERT INTO DEPENDENTE VALUES ('12345678966','Michael','M','1988-01-04','Filho');
INSERT INTO DEPENDENTE VALUES ('12345678966','Alicia','F','1988-12-30','Filha');
INSERT INTO DEPENDENTE VALUES ('12345678966','Elizabeth','F','1967-05-05','Esposa');

select * from funcionario;
select * from projeto;
select * from trabalha_em;